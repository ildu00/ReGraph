<!doctype html>
<html lang="en" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Reduce stale HTML caching that can cause blank screens on mobile after deploys -->
    <meta http-equiv="Cache-Control" content="no-store, max-age=0" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />

    <!-- Some mobile browsers (notably iOS private mode) can throw on localStorage access.
         If that happens during auth/client init, the app can fail before React mounts.
         Patch Storage methods to fall back to in-memory storage instead of throwing. -->
    <script>
      (function () {
        function canUseStorage(s) {
          try {
            if (!s) return false;
            var k = "__regraph_storage_test__";
            s.setItem(k, "1");
            s.removeItem(k);
            return true;
          } catch (e) {
            return false;
          }
        }

        var okLocal = canUseStorage(window.localStorage);
        var okSession = canUseStorage(window.sessionStorage);
        if (okLocal && okSession) return;

        var memLocal = new Map();
        var memSession = new Map();

        function pick(thisArg) {
          try {
            if (thisArg === window.sessionStorage) return memSession;
          } catch (e) {
            // ignore
          }
          return memLocal;
        }

        function wrap(proto, name, fn) {
          try {
            var orig = proto[name];
            if (typeof orig !== "function") return;
            proto[name] = function () {
              try {
                return orig.apply(this, arguments);
              } catch (e) {
                return fn.apply(this, arguments);
              }
            };
          } catch (e) {
            // ignore
          }
        }

        try {
          var proto = window.Storage && window.Storage.prototype;
          if (!proto) return;

          wrap(proto, "getItem", function (key) {
            var m = pick(this);
            key = String(key);
            return m.has(key) ? m.get(key) : null;
          });
          wrap(proto, "setItem", function (key, value) {
            var m = pick(this);
            m.set(String(key), String(value));
          });
          wrap(proto, "removeItem", function (key) {
            var m = pick(this);
            m.delete(String(key));
          });
          wrap(proto, "clear", function () {
            pick(this).clear();
          });
          wrap(proto, "key", function (i) {
            var keys = Array.from(pick(this).keys());
            return keys[i] || null;
          });

          // Best-effort length getter fallback
          try {
            Object.defineProperty(proto, "length", {
              get: function () {
                try {
                  // If native works, prefer it
                  return Object.getOwnPropertyDescriptor(window.localStorage.__proto__, "length")?.get?.call(this);
                } catch (e) {
                  return pick(this).size;
                }
              },
              configurable: true,
            });
          } catch (e) {
            // ignore
          }

          window.__regraph_storage_fallback = true;
        } catch (e) {
          // ignore
        }
      })();
    </script>
    <title>ReGraph - Decentralized AI Compute Marketplace | 80% Cheaper Than Cloud</title>
    <meta name="description" content="Access 50+ AI models at up to 80% lower cost than AWS, Google Cloud & OpenAI. Decentralized GPU, TPU & NPU network for inference and training. OpenAI-compatible API." />
    <meta name="keywords" content="AI compute, decentralized AI, GPU marketplace, AI inference, machine learning, LLM API, GPT-5, Claude, Llama, cheap AI, distributed computing, GPU rental, AI training, neural network, crypto AI" />
    <meta name="author" content="ReGraph" />
    <meta name="robots" content="index, follow" />
    
    <!-- Preconnect to critical origins -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <!-- Load fonts asynchronously to prevent render blocking -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700;800&display=swap" media="print" onload="this.media='all'" />
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700;800&display=swap" /></noscript>
    
    <link rel="icon" type="image/png" href="/favicon.png" />
    <link rel="apple-touch-icon" href="/favicon.png" />

    <meta property="og:title" content="ReGraph - Decentralized AI Compute Marketplace" />
    <meta property="og:description" content="Access 50+ AI models at up to 80% lower cost. Decentralized GPU network for inference and training. OpenAI-compatible API." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://regraph.tech" />
    <meta property="og:image" content="https://regraph.tech/og-image.png" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:site_name" content="ReGraph" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@ReGraphAI" />
    <meta name="twitter:title" content="ReGraph - Decentralized AI Compute Marketplace" />
    <meta name="twitter:description" content="Access 50+ AI models at up to 80% lower cost. Decentralized GPU network for inference and training." />
    <meta name="twitter:image" content="https://regraph.tech/og-image.png" />
    
    <link rel="canonical" href="https://regraph.tech" />
  </head>

  <body>
    <!-- Minimal boot spinner (no text) to avoid a pure black screen if JS is slow/blocked -->
    <div id="boot-spinner" aria-hidden="true"></div>

    <div id="root"></div>

    <!-- If React never mounts (mobile cache/BFCache or partial JS eval), recover silently. -->
    <script>
      (function () {
        var MAX_ATTEMPTS = 2;
        var MOUNT_FLAG = "__regraphMounted";
        var PARAM = "__regraph_boot";
        var LEGACY_PARAM = "__regrarph_boot";

        function now() {
          return Date.now();
        }

        function safeUrl() {
          try {
            return new URL(window.location.href);
          } catch (e) {
            return null;
          }
        }

        function getAttempts(u) {
          var raw = u.searchParams.get(PARAM) || u.searchParams.get(LEGACY_PARAM) || "0";
          var n = parseInt(raw, 10);
          return isFinite(n) ? n : 0;
        }

        function setAttempt(u, n) {
          u.searchParams.set(PARAM, String(n));
          u.searchParams.delete(LEGACY_PARAM);
          u.searchParams.set("__reload", String(now()));
        }

        function record(kind, detail) {
          try {
            localStorage.setItem(
              "__regraph_boot_diag",
              JSON.stringify({ t: now(), kind: kind, detail: String(detail || "") })
            );
          } catch (e) {
            // ignore
          }
        }

        window.addEventListener("error", function (e) {
          record("error", (e && (e.message || (e.error && e.error.message))) || "unknown");
        });
        window.addEventListener("unhandledrejection", function (e) {
          record("rejection", e && e.reason ? e.reason : "unknown");
        });

        function isMounted() {
          return !!window[MOUNT_FLAG];
        }

        function removeSpinner() {
          var el = document.getElementById("boot-spinner");
          if (el) el.remove();
        }

        function sendBootEvent(reason, attempts) {
          try {
            var diag = null;
            try {
              var raw = localStorage.getItem("__regraph_boot_diag");
              if (raw) diag = JSON.parse(raw);
            } catch (e) {
              // ignore
            }

            var payload = {
              reason: reason,
              url: window.location.href,
              userAgent: navigator.userAgent,
              diag: diag,
              storageFallback: !!window.__regraph_storage_fallback,
              attempts: attempts || 0,
            };

            // Use sendBeacon for reliability (works even if page is closing)
            var url = "https://rwzyvgralronyuzqwyhu.supabase.co/functions/v1/log-boot-event";
            if (navigator.sendBeacon) {
              navigator.sendBeacon(url, JSON.stringify(payload));
            } else {
              fetch(url, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload),
                keepalive: true,
              }).catch(function () {});
            }
          } catch (e) {
            // ignore - best effort
          }
        }

        function showFatalScreen(reason) {
          removeSpinner();

          // Send boot event to backend
          try {
            var u = safeUrl();
            var attempts = u ? getAttempts(u) : 0;
            sendBootEvent(reason, attempts);
          } catch (e) {
            // ignore
          }

          try {
            var existing = document.getElementById("boot-fatal");
            if (existing) return;

            var diag = "";
            try {
              diag = localStorage.getItem("__regraph_boot_diag") || "";
            } catch (e) {
              diag = "";
            }

            var box = document.createElement("div");
            box.id = "boot-fatal";
            box.setAttribute("role", "alert");
            box.style.cssText =
              "position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:10000;padding:24px;background:rgba(0,0,0,0.88);color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;";

            var card = document.createElement("div");
            card.style.cssText =
              "max-width:560px;width:100%;border:1px solid rgba(255,255,255,0.18);border-radius:14px;padding:18px;background:rgba(20,20,20,0.92);";

            var h = document.createElement("div");
            h.textContent = "Failed to load application";
            h.style.cssText = "font-weight:700;font-size:18px;";

            var p = document.createElement("div");
            p.textContent =
              "It looks like the browser served stale files or session storage failed. Click 'Restart' to reload with a fresh cache.";
            p.style.cssText = "margin-top:10px;line-height:1.35;font-size:13px;opacity:0.92;";

            var btn = document.createElement("button");
            btn.type = "button";
            btn.textContent = "Restart";
            btn.style.cssText =
              "margin-top:14px;appearance:none;border:0;border-radius:10px;padding:10px 14px;background:#ffffff;color:#000;font-weight:700;cursor:pointer;";
            btn.onclick = function () {
              var u = safeUrl();
              if (!u) return window.location.reload();
              u.searchParams.set("__reload", String(now()));
              u.searchParams.set("__regraph_force", "1");
              u.searchParams.delete(PARAM);
              u.searchParams.delete(LEGACY_PARAM);
              window.location.href = u.toString();
            };

            var pre = document.createElement("pre");
            pre.style.cssText =
              "margin-top:14px;padding:10px;border-radius:10px;background:rgba(255,255,255,0.06);max-height:180px;overflow:auto;font-size:11px;white-space:pre-wrap;word-break:break-word;opacity:0.95;";
            pre.textContent =
              "reason=" + String(reason || "unknown") + "\n" +
              "url=" + String(window.location.href) + "\n" +
              (diag ? "diag=" + diag + "\n" : "") +
              "ua=" + String(navigator.userAgent);

            card.appendChild(h);
            card.appendChild(p);
            card.appendChild(btn);
            card.appendChild(pre);
            box.appendChild(card);
            document.body.appendChild(box);
          } catch (e) {
            // If even this fails, at least don't show an infinite spinner.
            removeSpinner();
          }
        }

        function recover() {
          if (isMounted()) return;

          var u = safeUrl();
          if (!u) return;

          var attempts = getAttempts(u);

          // After a couple tries, never trap the user behind an infinite spinner.
          if (attempts >= MAX_ATTEMPTS) {
            showFatalScreen("max_attempts");
            return;
          }

          var main = document.getElementById("boot-main");
          var src = main && main.getAttribute("src");

          // Probe whether the main module is reachable (common failure: old HTML points to missing hashed asset).
          if (src) {
            var bust = src + (src.indexOf("?") === -1 ? "?" : "&") + "__probe=" + now();
            fetch(bust, { cache: "no-store" })
              .then(function (res) {
                record("probe", res.status + " " + bust);

                setAttempt(u, attempts + 1);
                // Navigate (changes URL) to force a fresh HTML + asset graph.
                window.location.href = u.toString();
              })
              .catch(function (err) {
                record("probe_error", err);

                setAttempt(u, attempts + 1);
                window.location.href = u.toString();
              });
            return;
          }

          // Fallback: just navigate with a cache-buster.
          setAttempt(u, attempts + 1);
          window.location.href = u.toString();
        }

        // Give the app a moment to mount. If it doesn't, recover.
        setTimeout(recover, 6000);

        // Hard deadline: never keep users on an endless spinner.
        setTimeout(function () {
          if (!isMounted()) showFatalScreen("deadline");
        }, 15000);
      })();
    </script>

    <script id="boot-main" type="module" src="/src/main.tsx"></script>

    <style>
      #boot-spinner{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none;z-index:9999}
      #boot-spinner:before{content:"";width:24px;height:24px;border-radius:999px;border:2px solid hsl(270 60% 50% / 0.2);border-top-color:hsl(270 60% 50%);animation:bootspin 900ms linear infinite}
      @keyframes bootspin{to{transform:rotate(360deg)}}
    </style>
  </body>
</html>
